webpackJsonp([40],{2112:function(l,n,e){"use strict";function t(l){return r._57(0,[(l()(),r._31(0,0,null,null,2,"p",[["text-end",""]],null,null,null,null,null)),(l()(),r._55(1,null,["",""])),r._49(2,1)],null,function(l,n){l(n,1,0,r._56(n,1,0,l(n,2,0,r._44(n.parent.parent,0),n.parent.context.$implicit.spaceUsage)))})}function a(l){return r._57(0,[(l()(),r._31(0,0,null,null,3,"p",[["text-end",""]],null,null,null,null,null)),(l()(),r._55(1,null,["",""])),r._48(2,{$a:0}),r._47(131072,F.a,[N.a,r.j])],null,function(l,n){l(n,1,0,r._56(n,1,0,r._44(n,3).transform("core.settings.entriesincache",l(n,2,0,n.parent.context.$implicit.cacheEntries))))})}function u(l){return r._57(0,[(l()(),r._31(0,0,null,null,30,"ion-item",[["class","item item-block"]],[[2,"core-primary-selected-item",null]],null,null,M.b,M.a)),r._30(1,1097728,null,3,A.a,[z.a,G.a,r.t,r.V,[2,J.a]],null,null),r._52(335544320,1,{contentLabel:0}),r._52(603979776,2,{_buttons:1}),r._52(603979776,3,{_icons:1}),r._30(5,16384,null,0,K.a,[],null,null),(l()(),r._55(-1,2,["\n            "])),(l()(),r._31(7,0,null,2,2,"h2",[["text-wrap",""]],null,null,null,null,null)),(l()(),r._31(8,16777216,null,null,1,"core-format-text",[["clean","true"]],null,null,null,null,null)),r._30(9,540672,null,0,q.a,[r.t,d.a,p.a,B.a,N.a,H.a,Q.a,W.a,X.a,f.a,c.a,Y.a,[2,Z.a],[2,ll.a],[2,nl.a],el.a,_.a,g.a,tl.a,al.a,r._11],{text:[0,"text"],siteId:[1,"siteId"],clean:[2,"clean"]},null),(l()(),r._55(-1,2,["\n            "])),(l()(),r._31(11,0,null,2,1,"p",[["text-wrap",""]],null,null,null,null,null)),(l()(),r._55(12,null,["",""])),(l()(),r._55(-1,2,["\n            "])),(l()(),r._31(14,0,null,4,7,"div",[["item-end",""]],null,null,null,null,null)),(l()(),r._55(-1,null,["\n                "])),(l()(),r._26(16777216,null,null,1,null,t)),r._30(17,16384,null,0,ul.k,[r._11,r._6],{ngIf:[0,"ngIf"]},null),(l()(),r._55(-1,null,["\n                "])),(l()(),r._26(16777216,null,null,1,null,a)),r._30(20,16384,null,0,ul.k,[r._11,r._6],{ngIf:[0,"ngIf"]},null),(l()(),r._55(-1,null,["\n            "])),(l()(),r._55(-1,2,["\n            "])),(l()(),r._31(23,0,null,4,6,"button",[["clear",""],["color","danger"],["icon-only",""],["ion-button",""],["item-end",""]],[[8,"hidden",0],[1,"aria-label",0]],[[null,"click"]],function(l,n,e){var t=!0;if("click"===n){t=!1!==l.component.deleteSiteStorage(l.context.$implicit)&&t}return t},il.b,il.a)),r._30(24,1097728,[[2,4]],0,rl.a,[[8,""],G.a,r.t,r.V],{color:[0,"color"],clear:[1,"clear"]},null),r._47(131072,F.a,[N.a,r.j]),(l()(),r._55(-1,0,["\n                "])),(l()(),r._31(27,0,null,0,1,"ion-icon",[["name","trash"],["role","img"]],[[2,"hide",null]],null,null,null,null)),r._30(28,147456,null,0,ol.a,[G.a,r.t,r.V],{name:[0,"name"]},null),(l()(),r._55(-1,0,["\n            "])),(l()(),r._55(-1,2,["\n        "]))],function(l,n){l(n,9,0,n.context.$implicit.siteName,n.context.$implicit.id,"true");l(n,17,0,null!=n.context.$implicit.spaceUsage);l(n,20,0,null!=n.context.$implicit.cacheEntries);l(n,24,0,"danger","");l(n,28,0,"trash")},function(l,n){l(n,0,0,n.context.$implicit.id==n.component.currentSiteId);l(n,12,0,n.context.$implicit.fullName);l(n,23,0,!n.context.$implicit.spaceUsage>"0"&&!n.context.$implicit.cacheEntries>"0",r._56(n,23,1,r._44(n,25).transform("core.settings.deletesitefilestitle")));l(n,27,0,r._44(n,28)._hidden)})}function i(l){return r._57(0,[r._47(0,sl.a,[X.a,B.a]),(l()(),r._31(1,0,null,null,12,"ion-header",[],null,null,null,null,null)),r._30(2,16384,null,0,cl.a,[G.a,r.t,r.V,[2,_l.a]],null,null),(l()(),r._55(-1,null,["\n    "])),(l()(),r._31(4,0,null,null,8,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,fl.b,fl.a)),r._30(5,49152,null,0,dl.a,[pl.a,[2,_l.a],[2,Z.a],G.a,r.t,r.V],null,null),r._30(6,212992,null,0,hl.a,[dl.a,H.a,N.a,_.a],null,null),(l()(),r._55(-1,3,["\n        "])),(l()(),r._31(8,0,null,3,3,"ion-title",[],null,null,null,gl.b,gl.a)),r._30(9,49152,null,0,ml.a,[G.a,r.t,r.V,[2,bl.a],[2,dl.a]],null,null),(l()(),r._55(10,0,["",""])),r._47(131072,F.a,[N.a,r.j]),(l()(),r._55(-1,3,["\n    "])),(l()(),r._55(-1,null,["\n"])),(l()(),r._55(-1,null,["\n"])),(l()(),r._31(15,0,null,null,41,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,vl.b,vl.a)),r._30(16,4374528,null,0,ll.a,[G.a,H.a,Pl.a,r.t,r.V,pl.a,Sl.a,r.M,[2,_l.a],[2,Z.a]],null,null),(l()(),r._55(-1,1,["\n    "])),(l()(),r._31(18,0,null,2,6,"ion-refresher",[],[[2,"refresher-active",null],[4,"top",null]],[[null,"ionRefresh"]],function(l,n,e){var t=!0;if("ionRefresh"===n){t=!1!==l.component.refreshData(e)&&t}return t},null,null)),r._30(19,212992,null,0,Ul.a,[H.a,ll.a,r.M,yl.l],{enabled:[0,"enabled"]},{ionRefresh:"ionRefresh"}),(l()(),r._55(-1,null,["\n        "])),(l()(),r._31(21,0,null,null,2,"ion-refresher-content",[],[[1,"state",0]],null,null,xl.b,xl.a)),r._30(22,114688,null,0,Rl.a,[Ul.a,G.a],{pullingText:[0,"pullingText"]},null),r._47(131072,F.a,[N.a,r.j]),(l()(),r._55(-1,null,["\n    "])),(l()(),r._55(-1,1,["\n    "])),(l()(),r._31(26,0,null,1,29,"core-loading",[],null,null,null,El.b,El.a)),r._30(27,638976,null,0,jl.a,[N.a,r.t,_.a,Q.a],{hideUntil:[0,"hideUntil"]},null),(l()(),r._55(-1,0,["\n        "])),(l()(),r._26(16777216,null,0,1,null,u)),r._30(30,802816,null,0,ul.j,[r._11,r._6,r.E],{ngForOf:[0,"ngForOf"]},null),(l()(),r._55(-1,0,["\n        "])),(l()(),r._31(32,0,null,0,22,"ion-item-divider",[["class","item item-divider"]],null,null,null,M.b,M.a)),r._30(33,1097728,null,3,A.a,[z.a,G.a,r.t,r.V,[2,J.a]],null,null),r._52(335544320,4,{contentLabel:0}),r._52(603979776,5,{_buttons:1}),r._52(603979776,6,{_icons:1}),r._30(37,16384,null,0,Il.a,[G.a,r.t,r.V],null,null),(l()(),r._55(-1,2,["\n            "])),(l()(),r._31(39,0,null,2,2,"p",[],null,null,null,null,null)),(l()(),r._55(40,null,["",""])),r._47(131072,F.a,[N.a,r.j]),(l()(),r._55(-1,2,["\n            "])),(l()(),r._31(43,0,null,4,10,"div",[["item-end",""]],null,null,null,null,null)),(l()(),r._55(-1,null,["\n                "])),(l()(),r._31(45,0,null,null,2,"p",[],null,null,null,null,null)),(l()(),r._55(46,null,["",""])),r._49(47,1),(l()(),r._55(-1,null,["\n                "])),(l()(),r._31(49,0,null,null,3,"p",[],null,null,null,null,null)),(l()(),r._55(50,null,["",""])),r._48(51,{$a:0}),r._47(131072,F.a,[N.a,r.j]),(l()(),r._55(-1,null,["\n            "])),(l()(),r._55(-1,2,["\n        "])),(l()(),r._55(-1,0,["\n    "])),(l()(),r._55(-1,1,["\n"])),(l()(),r._55(-1,null,["\n"]))],function(l,n){var e=n.component;l(n,6,0);l(n,19,0,e.usageLoaded);l(n,22,0,r._34(1,"",r._56(n,22,0,r._44(n,23).transform("core.pulltorefresh")),""));l(n,27,0,e.usageLoaded);l(n,30,0,e.sites)},function(l,n){var e=n.component;l(n,4,0,r._44(n,5)._hidden,r._44(n,5)._sbPadding);l(n,10,0,r._56(n,10,0,r._44(n,11).transform("core.settings.spaceusage")));l(n,15,0,r._44(n,16).statusbarPadding,r._44(n,16)._hasRefresher);l(n,18,0,"inactive"!==r._44(n,19).state,r._44(n,19)._top);l(n,21,0,r._44(n,22).r.state);l(n,40,0,r._56(n,40,0,r._44(n,41).transform("core.settings.total")));l(n,46,0,r._56(n,46,0,l(n,47,0,r._44(n,0),e.totalUsage)));l(n,50,0,r._56(n,50,0,r._44(n,52).transform("core.settings.entriesincache",l(n,51,0,e.totalEntries))))})}Object.defineProperty(n,"__esModule",{value:!0});var r=e(0),o=e(5),s=e(3),c=e(9),_=e(10),f=e(18),d=e(1),p=e(4),h=e(13),g=e(42),m=this&&this.__decorate||function(l,n,e,t){var a,u=arguments.length,i=u<3?n:null===t?t=Object.getOwnPropertyDescriptor(n,e):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(l,n,e,t);else for(var r=l.length-1;r>=0;r--)(a=l[r])&&(i=(u<3?a(i):u>3?a(n,e,i):a(n,e))||i);return u>3&&i&&Object.defineProperty(n,e,i),i},b=this&&this.__metadata||function(l,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(l,n)},v=function(){function l(l,n,e,t,a,u,i,r){this.filePoolProvider=l,this.eventsProvider=n,this.sitesProvider=e,this.filterProvider=t,this.translate=a,this.domUtils=u,this.courseProvider=r,this.usageLoaded=!1,this.sites=[],this.currentSiteId="",this.totalUsage=0,this.totalEntries=0,this.currentSiteId=this.sitesProvider.getCurrentSiteId()}return l.prototype.ionViewDidLoad=function(){var l=this;this.fetchData().finally(function(){l.usageLoaded=!0})},l.prototype.calculateSizeUsage=function(){var l=this;return this.sitesProvider.getSortedSites().then(function(n){l.sites=n;var e=l.sites.map(function(n){return l.sitesProvider.getSite(n.id).then(function(e){var t=[];return t.push(l.calcSiteClearRows(e).then(function(l){n.cacheEntries=l})),t.push(e.getSpaceUsage().then(function(l){n.spaceUsage=l})),Promise.all(t)})});return Promise.all(e)})},l.prototype.calculateTotalUsage=function(){var l=0,n=0;this.sites.forEach(function(e){l+=e.spaceUsage?parseInt(e.spaceUsage,10):0,n+=e.cacheEntries?parseInt(e.cacheEntries,10):0}),this.totalUsage=l,this.totalEntries=n},l.prototype.fetchData=function(){var l=this,n=[this.calculateSizeUsage().then(function(){return l.calculateTotalUsage()})];return Promise.all(n)},l.prototype.refreshData=function(l){this.fetchData().finally(function(){l.complete()})},l.prototype.updateSiteUsage=function(l,n){var e=l.spaceUsage;l.spaceUsage=n,this.totalUsage-=e-n},l.prototype.calcSiteClearRows=function(l){var n=0,e=this.sitesProvider.getSiteTableSchemasToClear(l).map(function(e){return l.getDb().countRecords(e).then(function(l){n+=l})});return Promise.all(e).then(function(){return n})},l.prototype.deleteSiteStorage=function(l){var n=this;this.filterProvider.formatText(l.siteName,{clean:!0,singleLine:!0,filter:!1},[],l.id).then(function(e){var t=n.translate.instant("core.settings.deletesitefilestitle"),a=n.translate.instant("core.settings.deletesitefiles",{sitename:e});n.domUtils.showConfirm(a,t).then(function(){return n.sitesProvider.getSite(l.id)}).then(function(e){var t=n.sitesProvider.getSiteTableSchemasToClear(e).map(function(l){return e.getDb().deleteRecords(l)});return t.push(e.deleteFolder().then(function(){n.filePoolProvider.clearAllPackagesStatus(e.id),n.filePoolProvider.clearFilepool(e.id),n.updateSiteUsage(l,0),n.courseProvider.clearAllCoursesStatus(e.id)}).catch(function(t){t&&t.code===FileError.NOT_FOUND_ERR?(n.filePoolProvider.clearAllPackagesStatus(e.id),n.updateSiteUsage(l,0)):(n.domUtils.showErrorModal("core.settings.errordeletesitefiles",!0),e.getSpaceUsage().then(function(e){n.updateSiteUsage(l,e)}))}).finally(function(){n.eventsProvider.trigger(_.a.SITE_STORAGE_DELETED,{},e.getId()),n.calcSiteClearRows(e).then(function(n){l.cacheEntries=n})})),Promise.all(t)}).catch(function(){})})},l=m([Object(r.m)({selector:"page-core-settings-space-usage",templateUrl:"space-usage.html"}),b("design:paramtypes",[f.a,_.a,d.a,g.a,s.c,p.a,c.a,h.a])],l)}(),P=e(28),S=e(32),U=e(108),y=this&&this.__decorate||function(l,n,e,t){var a,u=arguments.length,i=u<3?n:null===t?t=Object.getOwnPropertyDescriptor(n,e):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(l,n,e,t);else for(var r=l.length-1;r>=0;r--)(a=l[r])&&(i=(u<3?a(i):u>3?a(n,e,i):a(n,e))||i);return u>3&&i&&Object.defineProperty(n,e,i),i},x=function(){function l(){}return l=y([Object(r.I)({declarations:[v],imports:[P.a,S.a,U.a,o.l.forChild(v),s.b.forChild()]})],l)}(),R=e(1525),E=e(1526),j=e(1527),I=e(1528),O=e(1529),D=e(1530),T=e(1531),$=e(1532),w=e(1533),C=e(1534),V=e(1535),k=e(1536),L=e(1537),F=e(25),N=e(17),M=e(30),A=e(20),z=e(19),G=e(8),J=e(26),K=e(33),q=e(48),B=e(11),H=e(16),Q=e(2),W=e(22),X=e(6),Y=e(15),Z=e(21),ll=e(29),nl=e(27),el=e(43),tl=e(31),al=e(36),ul=e(7),il=e(45),rl=e(41),ol=e(47),sl=e(1582),cl=e(374),_l=e(39),fl=e(724),dl=e(213),pl=e(35),hl=e(477),gl=e(725),ml=e(315),bl=e(250),vl=e(182),Pl=e(34),Sl=e(109),Ul=e(160),yl=e(44),xl=e(214),Rl=e(174),El=e(54),jl=e(51),Il=e(102),Ol=r._29({encapsulation:2,styles:[],data:{}}),Dl=r._27("page-core-settings-space-usage",v,function(l){return r._57(0,[(l()(),r._31(0,0,null,null,1,"page-core-settings-space-usage",[],null,null,null,i,Ol)),r._30(1,49152,null,0,v,[f.a,_.a,d.a,g.a,N.a,p.a,c.a,h.a],null,null)],null,null)},{},{},[]),Tl=e(23),$l=e(370),wl=e(371),Cl=e(373),Vl=e(372),kl=e(476),Ll=e(723),Fl=e(273);e.d(n,"CoreSettingsSpaceUsagePageModuleNgFactory",function(){return Nl});var Nl=r._28(x,[],function(l){return r._40([r._41(512,r.o,r._21,[[8,[R.a,E.a,j.a,I.a,O.a,D.a,T.a,$.a,w.a,C.a,V.a,k.a,L.a,Dl]],[3,r.o],r.K]),r._41(4608,ul.m,ul.l,[r.G,[2,ul.w]]),r._41(4608,Tl.x,Tl.x,[]),r._41(4608,Tl.d,Tl.d,[]),r._41(4608,$l.b,$l.a,[]),r._41(4608,wl.a,wl.b,[]),r._41(4608,Cl.b,Cl.a,[]),r._41(4608,Vl.b,Vl.a,[]),r._41(4608,N.a,N.a,[kl.a,$l.b,wl.a,Cl.b,Vl.b,N.b,N.c]),r._41(512,ul.b,ul.b,[]),r._41(512,Tl.v,Tl.v,[]),r._41(512,Tl.i,Tl.i,[]),r._41(512,Tl.s,Tl.s,[]),r._41(512,Ll.a,Ll.a,[]),r._41(512,s.b,s.b,[]),r._41(512,S.a,S.a,[]),r._41(512,U.a,U.a,[]),r._41(512,P.a,P.a,[]),r._41(512,Ll.b,Ll.b,[]),r._41(512,x,x,[]),r._41(256,N.c,void 0,[]),r._41(256,N.b,void 0,[]),r._41(256,Fl.a,v,[])])})}});