webpackJsonp([137],{2163:function(n,e,t){"use strict";function l(n){return E._57(0,[(n()(),E._31(0,0,null,null,1,"ion-icon",[["name","funnel"],["role","img"]],[[2,"hide",null]],null,null,null,null)),E._30(1,147456,null,0,on.a,[un.a,E.t,E.V],{name:[0,"name"]},null)],function(n,e){n(e,1,0,"funnel")},function(n,e){n(e,0,0,E._44(e,1)._hidden)})}function i(n){return E._57(0,[(n()(),E._31(0,0,null,null,1,"ion-icon",[["name","ios-funnel-outline"],["role","img"]],[[2,"hide",null]],null,null,null,null)),E._30(1,147456,null,0,on.a,[un.a,E.t,E.V],{name:[0,"name"]},null)],function(n,e){n(e,1,0,"ios-funnel-outline")},function(n,e){n(e,0,0,E._44(e,1)._hidden)})}function a(n){return E._57(0,[(n()(),E._31(0,0,null,null,8,"ion-card",[["class","core-warning-card"],["icon-start",""]],null,null,null,null,null)),E._30(1,16384,null,0,sn.a,[un.a,E.t,E.V],null,null),(n()(),E._55(-1,null,["\n                "])),(n()(),E._31(3,0,null,null,1,"ion-icon",[["name","warning"],["role","img"]],[[2,"hide",null]],null,null,null,null)),E._30(4,147456,null,0,on.a,[un.a,E.t,E.V],{name:[0,"name"]},null),(n()(),E._55(5,null,[" ","\n            "])),E._47(131072,cn.a,[dn.a,E.j]),E._48(7,{$a:0}),E._47(131072,cn.a,[dn.a,E.j])],function(n,e){n(e,4,0,"warning")},function(n,e){n(e,3,0,E._44(e,4)._hidden);n(e,5,0,E._56(e,5,0,E._44(e,8).transform("core.hasdatatosync",n(e,7,0,E._56(e,5,0,E._44(e,6).transform("addon.calendar.calendar"))))))})}function r(n){return E._57(0,[(n()(),E._31(0,0,null,null,3,"core-empty-box",[["icon","calendar"]],null,null,null,fn.b,fn.a)),E._30(1,49152,null,0,_n.a,[],{message:[0,"message"],icon:[1,"icon"]},null),E._47(131072,cn.a,[dn.a,E.j]),(n()(),E._55(-1,0,["\n            "]))],function(n,e){n(e,1,0,E._56(e,1,0,E._44(e,2).transform("addon.calendar.noevents")),"calendar")},null)}function o(n){return E._57(0,[(n()(),E._31(0,0,null,null,7,"ion-item-divider",[["class","item item-divider"]],null,null,null,hn.b,hn.a)),E._30(1,1097728,null,3,vn.a,[pn.a,un.a,E.t,E.V,[2,mn.a]],null,null),E._52(335544320,4,{contentLabel:0}),E._52(603979776,5,{_buttons:1}),E._52(603979776,6,{_icons:1}),E._30(5,16384,null,0,En.a,[un.a,E.t,E.V],null,null),(n()(),E._55(6,2,["\n                        ","\n                    "])),E._49(7,2)],null,function(n,e){n(e,6,0,E._56(e,6,0,n(e,7,0,E._44(e.parent.parent.parent,0),1e3*e.parent.context.$implicit.timestart,"strftimedayshort")))})}function u(n){return E._57(0,[(n()(),E._31(0,0,null,null,0,"img",[["class","core-module-icon"],["item-start",""]],[[8,"src",4]],null,null,null,null))],null,function(n,e){n(e,0,0,E._34(1,"",e.parent.context.$implicit.moduleIcon,""))})}function s(n){return E._57(0,[(n()(),E._31(0,0,null,null,1,"core-icon",[["item-start",""]],null,null,null,gn.b,gn.a)),E._30(1,704512,null,0,bn.a,[E.t,un.a],{name:[0,"name"]},null)],function(n,e){n(e,1,0,e.parent.context.$implicit.eventIcon)},null)}function c(n){return E._57(0,[(n()(),E._31(0,0,null,null,2,"span",[],null,null,null,null,null)),(n()(),E._55(1,null,[" - ",""])),E._49(2,2)],null,function(n,e){n(e,1,0,E._56(e,1,0,n(e,2,0,E._44(e.parent.parent.parent,0),1e3*(e.parent.context.$implicit.timestart+e.parent.context.$implicit.timeduration),"strftimetime")))})}function d(n){return E._57(0,[(n()(),E._31(0,0,null,null,2,"span",[],null,null,null,null,null)),(n()(),E._55(1,null,[" - ",""])),E._49(2,2)],null,function(n,e){n(e,1,0,E._56(e,1,0,n(e,2,0,E._44(e.parent.parent.parent,0),1e3*(e.parent.context.$implicit.timestart+e.parent.context.$implicit.timeduration),"strftimedatetimeshort")))})}function f(n){return E._57(0,[(n()(),E._31(0,0,null,null,9,"ion-note",[["item-end",""]],null,null,null,null,null)),E._30(1,16384,null,0,yn.a,[un.a,E.t,E.V],null,null),(n()(),E._55(-1,null,["\n                            "])),(n()(),E._31(3,0,null,null,1,"ion-icon",[["name","time"],["role","img"]],[[2,"hide",null]],null,null,null,null)),E._30(4,147456,null,0,on.a,[un.a,E.t,E.V],{name:[0,"name"]},null),(n()(),E._55(-1,null,["\n                            "])),(n()(),E._31(6,0,null,null,2,"span",[["text-wrap",""]],null,null,null,null,null)),(n()(),E._55(7,null,["",""])),E._47(131072,cn.a,[dn.a,E.j]),(n()(),E._55(-1,null,["\n                        "]))],function(n,e){n(e,4,0,"time")},function(n,e){n(e,3,0,E._44(e,4)._hidden);n(e,7,0,E._56(e,7,0,E._44(e,8).transform("core.notsent")))})}function _(n){return E._57(0,[(n()(),E._31(0,0,null,null,9,"ion-note",[["item-end",""]],null,null,null,null,null)),E._30(1,16384,null,0,yn.a,[un.a,E.t,E.V],null,null),(n()(),E._55(-1,null,["\n                            "])),(n()(),E._31(3,0,null,null,1,"ion-icon",[["name","trash"],["role","img"]],[[2,"hide",null]],null,null,null,null)),E._30(4,147456,null,0,on.a,[un.a,E.t,E.V],{name:[0,"name"]},null),(n()(),E._55(-1,null,["\n                            "])),(n()(),E._31(6,0,null,null,2,"span",[["text-wrap",""]],null,null,null,null,null)),(n()(),E._55(7,null,["",""])),E._47(131072,cn.a,[dn.a,E.j]),(n()(),E._55(-1,null,["\n                        "]))],function(n,e){n(e,4,0,"trash")},function(n,e){n(e,3,0,E._44(e,4)._hidden);n(e,7,0,E._56(e,7,0,E._44(e,8).transform("core.deletedoffline")))})}function h(n){return E._57(0,[(n()(),E._31(0,0,null,null,40,null,null,null,null,null,null,null)),(n()(),E._55(-1,null,["\n                    "])),(n()(),E._26(16777216,null,null,1,null,o)),E._30(3,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,null,["\n                    "])),(n()(),E._31(5,0,null,null,34,"a",[["class","addon-calendar-event item item-block"],["ion-item",""],["text-wrap",""]],[[8,"title",0],[2,"core-split-item-selected",null]],[[null,"click"]],function(n,e,t){var l=!0;if("click"===e){l=!1!==n.component.gotoEvent(n.context.$implicit.id)&&l}return l},hn.b,hn.a)),E._30(6,278528,null,0,In.i,[E.E,E.F,E.t,E.W],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),E._46(7,1),E._30(8,1097728,null,3,vn.a,[pn.a,un.a,E.t,E.V,[2,mn.a]],null,null),E._52(335544320,7,{contentLabel:0}),E._52(603979776,8,{_buttons:1}),E._52(603979776,9,{_icons:1}),E._30(12,16384,null,0,On.a,[],null,null),(n()(),E._55(-1,2,["\n                        "])),(n()(),E._26(16777216,null,0,1,null,u)),E._30(15,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,2,["\n                        "])),(n()(),E._26(16777216,null,0,1,null,s)),E._30(18,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,2,["\n                        "])),(n()(),E._31(20,0,null,2,2,"h2",[],null,null,null,null,null)),(n()(),E._31(21,16777216,null,null,1,"core-format-text",[],null,null,null,null,null)),E._30(22,540672,null,0,Cn.a,[E.t,N.a,T.a,Dn.a,dn.a,xn.a,V.a,Ln.a,wn.a,Sn.a,R.a,Tn.a,[2,An.a],[2,Vn.a],[2,$.a],Nn.a,k.a,Pn.a,kn.a,Rn.a,E._11],{text:[0,"text"],contextLevel:[1,"contextLevel"],contextInstanceId:[2,"contextInstanceId"]},null),(n()(),E._55(-1,2,["\n                        "])),(n()(),E._31(24,0,null,2,8,"p",[],null,null,null,null,null)),(n()(),E._55(25,null,["\n                            ","\n                            "])),E._49(26,2),(n()(),E._26(16777216,null,null,1,null,c)),E._30(28,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,null,["\n                            "])),(n()(),E._26(16777216,null,null,1,null,d)),E._30(31,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,null,["\n                        "])),(n()(),E._55(-1,2,["\n                        "])),(n()(),E._26(16777216,null,4,1,null,f)),E._30(35,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,2,["\n                        "])),(n()(),E._26(16777216,null,4,1,null,_)),E._30(38,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,2,["\n                    "])),(n()(),E._55(-1,null,["\n                "]))],function(n,e){n(e,3,0,e.context.$implicit.showDate);n(e,6,0,"addon-calendar-event",n(e,7,0,"addon-calendar-eventtype-"+e.context.$implicit.eventtype));n(e,15,0,e.context.$implicit.moduleIcon);n(e,18,0,e.context.$implicit.eventIcon&&!e.context.$implicit.moduleIcon);n(e,22,0,e.context.$implicit.name,e.context.$implicit.contextLevel,e.context.$implicit.contextInstanceId);n(e,28,0,e.context.$implicit.timeduration&&e.context.$implicit.endsSameDay);n(e,31,0,e.context.$implicit.timeduration&&!e.context.$implicit.endsSameDay);n(e,35,0,e.context.$implicit.offline&&!e.context.$implicit.deleted);n(e,38,0,e.context.$implicit.deleted)},function(n,e){n(e,5,0,e.context.$implicit.name,e.context.$implicit.id==e.component.eventId);n(e,25,0,E._56(e,25,0,n(e,26,0,E._44(e.parent.parent,0),1e3*e.context.$implicit.timestart,"strftimetime")))})}function v(n){return E._57(0,[(n()(),E._31(0,0,null,null,5,"ion-list",[["no-margin",""]],null,null,null,null,null)),E._30(1,16384,null,0,$n.a,[un.a,E.t,E.V,xn.a,jn.l,Mn.a],null,null),(n()(),E._55(-1,null,["\n                "])),(n()(),E._26(16777216,null,null,1,null,h)),E._30(4,802816,null,0,In.j,[E._11,E._6,E.E],{ngForOf:[0,"ngForOf"]},null),(n()(),E._55(-1,null,["\n            "]))],function(n,e){n(e,4,0,e.component.filteredEvents)},null)}function p(n){return E._57(0,[(n()(),E._31(0,0,null,null,13,"ion-fab",[["bottom",""],["core-fab",""],["end",""]],null,null,null,Un.b,Un.a)),E._30(1,212992,null,0,Hn.a,[E.t,Vn.a],null,null),E._30(2,1228800,null,2,Fn.a,[xn.a],null,null),E._52(335544320,10,{_mainButton:0}),E._52(603979776,11,{_fabLists:1}),(n()(),E._55(-1,0,["\n            "])),(n()(),E._31(6,0,null,0,6,"button",[["ion-fab",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,e,t){var l=!0;if("click"===e){l=!1!==n.component.openEdit()&&l}return l},Yn.b,Yn.a)),E._30(7,49152,[[10,4]],0,Wn.a,[un.a,E.t,E.V],null,null),E._47(131072,cn.a,[dn.a,E.j]),(n()(),E._55(-1,0,["\n                "])),(n()(),E._31(10,0,null,0,1,"ion-icon",[["name","add"],["role","img"]],[[2,"hide",null]],null,null,null,null)),E._30(11,147456,null,0,on.a,[un.a,E.t,E.V],{name:[0,"name"]},null),(n()(),E._55(-1,0,["\n            "])),(n()(),E._55(-1,0,["\n        "]))],function(n,e){n(e,1,0);n(e,11,0,"add")},function(n,e){n(e,6,0,E._56(e,6,0,E._44(e,8).transform("addon.calendar.newevent")));n(e,10,0,E._44(e,11)._hidden)})}function m(n){return E._57(0,[E._47(0,Gn.a,[wn.a,A.a]),E._52(402653184,1,{content:0}),E._52(402653184,2,{splitviewCtrl:0}),(n()(),E._31(3,0,null,null,40,"ion-header",[],null,null,null,null,null)),E._30(4,16384,null,0,zn.a,[un.a,E.t,E.V,[2,Bn.a]],null,null),(n()(),E._55(-1,null,["\n    "])),(n()(),E._31(6,0,null,null,36,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,Jn.b,Jn.a)),E._30(7,49152,null,0,Kn.a,[qn.a,[2,Bn.a],[2,An.a],un.a,E.t,E.V],null,null),E._30(8,212992,null,0,Qn.a,[Kn.a,xn.a,dn.a,k.a],null,null),(n()(),E._55(-1,3,["\n        "])),(n()(),E._31(10,0,null,3,3,"ion-title",[],null,null,null,Xn.b,Xn.a)),E._30(11,49152,null,0,Zn.a,[un.a,E.t,E.V,[2,ne.a],[2,Kn.a]],null,null),(n()(),E._55(12,0,["",""])),E._47(131072,cn.a,[dn.a,E.j]),(n()(),E._55(-1,3,["\n        "])),(n()(),E._31(15,0,null,2,26,"ion-buttons",[["end",""]],null,null,null,null,null)),E._30(16,16384,null,1,ee.a,[un.a,E.t,E.V,[2,ne.a],[2,Kn.a]],null,null),E._52(603979776,3,{_buttons:1}),(n()(),E._55(-1,null,["\n            "])),(n()(),E._31(19,0,null,null,9,"button",[["icon-only",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,e,t){var l=!0;if("click"===e){l=!1!==n.component.openFilter(t)&&l}return l},te.b,te.a)),E._30(20,1097728,[[3,4]],0,le.a,[[8,""],un.a,E.t,E.V],null,null),E._47(131072,cn.a,[dn.a,E.j]),(n()(),E._55(-1,0,["\n                "])),(n()(),E._26(16777216,null,0,1,null,l)),E._30(24,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,0,["\n                "])),(n()(),E._26(16777216,null,0,1,null,i)),E._30(27,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,0,["\n            "])),(n()(),E._55(-1,null,["\n            "])),(n()(),E._31(30,0,null,null,10,"core-context-menu",[],null,null,null,ie.b,ie.a)),E._30(31,245760,null,0,ae.a,[dn.a,re.a,E.t,T.a,[2,oe.a],V.a],null,null),(n()(),E._55(-1,0,["\n                "])),(n()(),E._31(33,0,null,0,2,"core-context-menu-item",[],null,[[null,"action"]],function(n,e,t){var l=!0;if("action"===e){l=!1!==n.component.openSettings()&&l}return l},ue.b,ue.a)),E._30(34,770048,null,0,se.a,[ae.a],{content:[0,"content"],iconAction:[1,"iconAction"],priority:[2,"priority"],hidden:[3,"hidden"]},{action:"action"}),E._47(131072,cn.a,[dn.a,E.j]),(n()(),E._55(-1,0,["\n                "])),(n()(),E._31(37,0,null,0,2,"core-context-menu-item",[],null,[[null,"action"]],function(n,e,t){var l=!0;if("action"===e){l=!1!==n.component.doRefresh(null,t,!0)&&l}return l},ue.b,ue.a)),E._30(38,770048,null,0,se.a,[ae.a],{content:[0,"content"],iconAction:[1,"iconAction"],closeOnClick:[2,"closeOnClick"],priority:[3,"priority"],hidden:[4,"hidden"]},{action:"action"}),E._47(131072,cn.a,[dn.a,E.j]),(n()(),E._55(-1,0,["\n            "])),(n()(),E._55(-1,null,["\n        "])),(n()(),E._55(-1,3,["\n    "])),(n()(),E._55(-1,null,["\n"])),(n()(),E._55(-1,null,["\n"])),(n()(),E._31(45,0,null,null,35,"core-split-view",[],null,null,null,ce.b,ce.a)),E._30(46,245760,[[2,4]],0,$.a,[[2,An.a],E.t,de.a,xn.a,dn.a],null,null),(n()(),E._55(-1,0,["\n    "])),(n()(),E._31(48,0,null,0,31,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,fe.b,fe.a)),E._30(49,4374528,[[1,4]],0,Vn.a,[un.a,xn.a,Mn.a,E.t,E.V,qn.a,_e.a,E.M,[2,Bn.a],[2,An.a]],null,null),(n()(),E._55(-1,1,["\n        "])),(n()(),E._31(51,0,null,2,6,"ion-refresher",[],[[2,"refresher-active",null],[4,"top",null]],[[null,"ionRefresh"]],function(n,e,t){var l=!0;if("ionRefresh"===e){l=!1!==n.component.doRefresh(t)&&l}return l},null,null)),E._30(52,212992,null,0,he.a,[xn.a,Vn.a,E.M,jn.l],{enabled:[0,"enabled"]},{ionRefresh:"ionRefresh"}),(n()(),E._55(-1,null,["\n            "])),(n()(),E._31(54,0,null,null,2,"ion-refresher-content",[],[[1,"state",0]],null,null,ve.b,ve.a)),E._30(55,114688,null,0,pe.a,[he.a,un.a],{pullingText:[0,"pullingText"]},null),E._47(131072,cn.a,[dn.a,E.j]),(n()(),E._55(-1,null,["\n        "])),(n()(),E._55(-1,1,["\n        "])),(n()(),E._31(59,0,null,1,15,"core-loading",[],null,null,null,me.b,me.a)),E._30(60,638976,null,0,Ee.a,[dn.a,E.t,k.a,V.a],{hideUntil:[0,"hideUntil"]},null),(n()(),E._55(-1,0,["\n            "])),(n()(),E._55(-1,0,["\n            "])),(n()(),E._26(16777216,null,0,1,null,a)),E._30(64,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,0,["\n\n            "])),(n()(),E._26(16777216,null,0,1,null,r)),E._30(67,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,0,["\n\n            "])),(n()(),E._26(16777216,null,0,1,null,v)),E._30(70,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,0,["\n\n            "])),(n()(),E._31(72,0,null,0,1,"core-infinite-loading",[],null,[[null,"action"]],function(n,e,t){var l=!0;if("action"===e){l=!1!==n.component.loadMoreEvents(t)&&l}return l},ge.b,ge.a)),E._30(73,573440,null,0,be.a,[[2,Vn.a],T.a],{enabled:[0,"enabled"],error:[1,"error"]},{action:"action"}),(n()(),E._55(-1,0,["\n        "])),(n()(),E._55(-1,1,["\n\n        "])),(n()(),E._55(-1,1,["\n        "])),(n()(),E._26(16777216,null,0,1,null,p)),E._30(78,16384,null,0,In.k,[E._11,E._6],{ngIf:[0,"ngIf"]},null),(n()(),E._55(-1,1,["\n    "])),(n()(),E._55(-1,0,["\n"]))],function(n,e){var t=e.component;n(e,8,0);n(e,24,0,t.filter.filtered);n(e,27,0,!t.filter.filtered),n(e,31,0);n(e,34,0,E._56(e,34,0,E._44(e,35).transform("core.settings.settings")),"cog",600,!t.notificationsEnabled);n(e,38,0,E._56(e,38,0,E._44(e,39).transform("core.settings.synchronizenow")),t.syncIcon,!1,400,!t.eventsLoaded||!t.hasOffline||!t.isOnline),n(e,46,0);n(e,52,0,t.eventsLoaded);n(e,55,0,E._34(1,"",E._56(e,55,0,E._44(e,56).transform("core.pulltorefresh")),""));n(e,60,0,t.eventsLoaded);n(e,64,0,t.hasOffline);n(e,67,0,!t.filteredEvents||!t.filteredEvents.length);n(e,70,0,t.filteredEvents&&t.filteredEvents.length);n(e,73,0,t.canLoadMore,t.loadMoreError);n(e,78,0,t.canCreate)},function(n,e){n(e,6,0,E._44(e,7)._hidden,E._44(e,7)._sbPadding);n(e,12,0,E._56(e,12,0,E._44(e,13).transform("addon.calendar.calendarevents")));n(e,19,0,E._56(e,19,0,E._44(e,21).transform("core.filter")));n(e,48,0,E._44(e,49).statusbarPadding,E._44(e,49)._hasRefresher);n(e,51,0,"inactive"!==E._44(e,52).state,E._44(e,52)._top);n(e,54,0,E._44(e,55).r.state)})}Object.defineProperty(e,"__esModule",{value:!0});var E=t(0),g=t(5),b=t(3),y=t(27),I=t(31),O=t(108),C=t(187),D=t(277),x=t(278),L=t(484),w=t(52),S=t(189),T=t(4),A=t(24),V=t(2),N=t(1),P=t(152),k=t(10),R=t(9),$=t(28),j=t(14),M=t(186),U=t(40),H=t(750),F=this&&this.__decorate||function(n,e,t,l){var i,a=arguments.length,r=a<3?e:null===l?l=Object.getOwnPropertyDescriptor(e,t):l;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,t,l);else for(var o=n.length-1;o>=0;o--)(i=n[o])&&(r=(a<3?i(r):a>3?i(e,t,r):i(e,t))||r);return a>3&&r&&Object.defineProperty(e,t,r),r},Y=this&&this.__metadata||function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)},W=function(){function n(n,e,t,l,i,a,r,o,u,s,c,d,f,_,h,v,p,m){var E=this;this.calendarProvider=a,this.domUtils=r,this.coursesProvider=o,this.utils=u,this.calendarHelper=s,this.coursesHelper=c,this.eventsProvider=d,this.navCtrl=f,this.appProvider=_,this.calendarOffline=h,this.calendarSync=v,this.timeUtils=p,this.popoverCtrl=m,this.initialTime=0,this.daysLoaded=0,this.emptyEventsTimes=0,this.categoriesRetrieved=!1,this.getCategories=!1,this.categories={},this.onlineEvents=[],this.offlineEvents=[],this.deletedEvents=[],this.eventsLoaded=!1,this.events=[],this.notificationsEnabled=!1,this.filteredEvents=[],this.canLoadMore=!1,this.loadMoreError=!1,this.canCreate=!1,this.hasOffline=!1,this.isOnline=!1,this.filter={filtered:!1,courseId:null,categoryId:null,course:!1,group:!1,site:!1,user:!1,category:!1},this.siteHomeId=e.getCurrentSite().getSiteHomeId(),this.notificationsEnabled=i.isAvailable(),this.currentSiteId=e.getCurrentSiteId(),this.notificationsEnabled&&(this.obsDefaultTimeChange=d.on(C.a.DEFAULT_NOTIFICATION_TIME_CHANGED,function(){a.scheduleEventsNotifications(E.onlineEvents)},this.currentSiteId)),this.eventId=n.get("eventId")||!1,C.a.ALL_TYPES.forEach(function(n){E.filter[n]=!0}),this.filter.courseId=n.get("courseId"),this.newEventObserver=d.on(C.a.NEW_EVENT_EVENT,function(n){n&&n.event&&(E.splitviewCtrl.isOn()&&E.splitviewCtrl.emptyDetails(),E.eventsLoaded=!1,E.refreshEvents(!0,!1).finally(function(){E.splitviewCtrl.isOn()&&n.event.id>0&&E.gotoEvent(n.event.id)}))},this.currentSiteId),this.discardedObserver=d.on(C.a.NEW_EVENT_DISCARDED_EVENT,function(){E.splitviewCtrl.isOn()&&E.splitviewCtrl.emptyDetails(),E.eventsLoaded=!1,E.refreshEvents(!0,!1)},this.currentSiteId),this.editEventObserver=d.on(C.a.EDIT_EVENT_EVENT,function(n){n&&n.event&&(E.eventsLoaded=!1,E.refreshEvents(!0,!1))},this.currentSiteId),this.syncObserver=d.on(L.a.AUTO_SYNCED,function(n){E.eventsLoaded=!1,E.refreshEvents(),E.splitviewCtrl.isOn()&&E.eventId&&n&&n.deleted&&-1!=n.deleted.indexOf(E.eventId)&&E.splitviewCtrl.emptyDetails()},this.currentSiteId),this.manualSyncObserver=d.on(L.a.MANUAL_SYNCED,function(n){n&&"list"!=n.source&&(E.eventsLoaded=!1,E.refreshEvents()),E.splitviewCtrl.isOn()&&E.eventId&&n&&n.deleted&&-1!=n.deleted.indexOf(E.eventId)&&E.splitviewCtrl.emptyDetails()},this.currentSiteId),this.deleteEventObserver=d.on(C.a.DELETED_EVENT_EVENT,function(n){n&&!n.sent?(E.markAsDeleted(n.eventId,!0),E.deletedEvents.push(n.eventId),E.hasOffline=!0):(E.splitviewCtrl.isOn()&&E.splitviewCtrl.emptyDetails(),E.eventsLoaded=!1,E.refreshEvents())},this.currentSiteId),this.undeleteEventObserver=d.on(C.a.UNDELETED_EVENT_EVENT,function(n){if(n&&n.eventId){E.markAsDeleted(n.eventId,!1);var e=E.deletedEvents.indexOf(n.eventId);-1!=e&&E.deletedEvents.splice(e,1),E.hasOffline=!!E.offlineEvents.length||!!E.deletedEvents.length}},this.currentSiteId),this.filterChangedObserver=this.eventsProvider.on(C.a.FILTER_CHANGED_EVENT,function(n){E.filter=n,E.calendarHelper.canEditEvents(E.filter.courseId).then(function(n){E.canCreate=n}),E.filterEvents(),E.domUtils.scrollToTop(E.content)}),this.onlineObserver=t.onchange().subscribe(function(){l.run(function(){E.isOnline=E.appProvider.isOnline()})})}return n.prototype.ionViewDidLoad=function(){var n=this;this.eventId&&this.gotoEvent(this.eventId),this.syncIcon="spinner",this.fetchData(!1,!0,!1).then(function(){!n.eventId&&n.splitviewCtrl.isOn()&&n.events.length>0&&n.gotoEvent(n.onlineEvents[0]?n.onlineEvents[0].id:n.offlineEvents[0].id)})},n.prototype.fetchData=function(n,e,t){var l=this;this.initialTime=this.timeUtils.timestamp(),this.daysLoaded=0,this.emptyEventsTimes=0,this.isOnline=this.appProvider.isOnline();return(e?this.calendarSync.syncEvents().then(function(n){n.warnings&&n.warnings.length&&l.domUtils.showErrorModal(n.warnings[0]),n.updated&&(n.source="list",l.eventsProvider.trigger(L.a.MANUAL_SYNCED,n,l.currentSiteId))}).catch(function(n){t&&l.domUtils.showErrorModalDefault(n,"core.errorsync",!0)}):Promise.resolve()).then(function(){var e=[];return l.hasOffline=!1,e.push(l.calendarHelper.canEditEvents(l.filter.courseId).then(function(n){l.canCreate=n})),e.push(l.coursesHelper.getCoursesForPopover(l.filter.courseId).then(function(e){return l.courses=e.courses,l.fetchEvents(n)})),e.push(l.calendarOffline.getAllEditedEvents().then(function(n){l.hasOffline=l.hasOffline||!!n.length,n.forEach(function(n){n.offline=!0,l.calendarHelper.formatEventData(n)}),l.offlineEvents=l.sortEvents(n)})),e.push(l.calendarOffline.getAllDeletedEventsIds().then(function(n){l.hasOffline=l.hasOffline||!!n.length,l.deletedEvents=n})),Promise.all(e)}).finally(function(){l.eventsLoaded=!0,l.syncIcon="sync"})},n.prototype.fetchEvents=function(n){var e=this;return this.loadMoreError=!1,this.calendarProvider.getEventsList(this.initialTime,this.daysLoaded,C.a.DAYS_INTERVAL).then(function(t){if(0===t.length){if(e.emptyEventsTimes++,!(e.emptyEventsTimes>5))return e.daysLoaded+=C.a.DAYS_INTERVAL,e.fetchEvents();e.canLoadMore=!1,n&&(e.onlineEvents=[],e.filteredEvents=[],e.events=e.offlineEvents)}else{t.forEach(e.calendarHelper.formatEventData.bind(e.calendarHelper));var l=e.mergeEvents(t);e.getCategories=e.shouldLoadCategories(t),n?(e.onlineEvents=t,e.events=l):(e.onlineEvents=e.utils.mergeArraysWithoutDuplicates(e.onlineEvents,t,"id"),e.events=e.utils.mergeArraysWithoutDuplicates(e.events,l,"id")),e.filterEvents(),e.filteredEvents.forEach(function(n,t){n.showDate=e.showDate(n,e.filteredEvents[t-1]),n.endsSameDay=e.endsSameDay(n)}),e.canLoadMore=!0,e.calendarProvider.scheduleEventsNotifications(e.onlineEvents),e.daysLoaded+=C.a.DAYS_INTERVAL}e.content.resize()}).catch(function(n){e.domUtils.showErrorModalDefault(n,"addon.calendar.errorloadevents",!0),e.loadMoreError=!0}).then(function(){if(e.getCategories)return e.getCategories=!1,e.loadCategories()})},n.prototype.loadMoreEvents=function(n){return this.fetchEvents().finally(function(){n&&n()})},n.prototype.filterEvents=function(){this.filteredEvents=this.calendarHelper.getFilteredEvents(this.events,this.filter,this.categories)},n.prototype.shouldLoadCategories=function(n){if(this.categoriesRetrieved||this.getCategories)return this.getCategories;return n.some(function(n){return"undefined"!=n.categoryid&&n.categoryid>0})||this.getCategories},n.prototype.loadCategories=function(){var n=this;return this.coursesProvider.getCategories(0,!0).then(function(e){n.categoriesRetrieved=!0,n.categories={},e.forEach(function(e){n.categories[e.id]=e})}).catch(function(){})},n.prototype.mergeEvents=function(n){var e=this;if(!this.offlineEvents.length&&!this.deletedEvents.length)return n;var t=this.initialTime+U.a.SECONDS_DAY*this.daysLoaded,l=t+U.a.SECONDS_DAY*C.a.DAYS_INTERVAL-1,i=n;this.deletedEvents.length&&i.forEach(function(n){n.deleted=-1!=e.deletedEvents.indexOf(n.id)}),this.offlineEvents.length&&(i=i.filter(function(n){return!e.offlineEvents.find(function(e){return e.id==n.id})}));var a=this.offlineEvents.filter(function(n){return 0==e.daysLoaded&&n.timestart<t||(n.timestart>=t||n.timestart+n.timeduration>=t)&&n.timestart<=l});return i=i.concat(a),this.sortEvents(i)},n.prototype.sortEvents=function(n){return n.sort(function(n,e){return n.timestart==e.timestart?n.timeduration-e.timeduration:n.timestart-e.timestart})},n.prototype.doRefresh=function(n,e,t){return this.eventsLoaded?this.refreshEvents(!0,t).finally(function(){n&&n.complete(),e&&e()}):Promise.resolve()},n.prototype.refreshEvents=function(n,e){var t=this;this.syncIcon="spinner";var l=[];return l.push(this.calendarProvider.invalidateEventsList()),l.push(this.calendarProvider.invalidateAllowedEventTypes()),this.categoriesRetrieved&&(l.push(this.coursesProvider.invalidateCategories(0,!0)),this.categoriesRetrieved=!1),Promise.all(l).finally(function(){return t.fetchData(!0,n,e)})},n.prototype.showDate=function(n,e){return!e||!j(1e3*n.timestart).isSame(1e3*e.timestart,"day")},n.prototype.endsSameDay=function(n){return!n.timeduration||j(1e3*n.timestart).isSame(1e3*(n.timestart+n.timeduration),"day")},n.prototype.openFilter=function(n){this.popoverCtrl.create(H.a,{courses:this.courses,filter:this.filter}).present({ev:n})},n.prototype.openEdit=function(n){this.eventId=void 0;var e={};n&&(e.eventId=n),this.filter.courseId&&(e.courseId=this.filter.courseId),this.splitviewCtrl.push("AddonCalendarEditEventPage",e)},n.prototype.openSettings=function(){this.navCtrl.push("AddonCalendarSettingsPage")},n.prototype.gotoEvent=function(n){this.eventId=n,n<0?this.openEdit(n):this.splitviewCtrl.push("AddonCalendarEventPage",{id:n})},n.prototype.markAsDeleted=function(n,e){var t=this.onlineEvents.find(function(e){return e.id==n});t&&(t.deleted=e)},n.prototype.ngOnDestroy=function(){this.obsDefaultTimeChange&&this.obsDefaultTimeChange.off(),this.newEventObserver&&this.newEventObserver.off(),this.discardedObserver&&this.discardedObserver.off(),this.editEventObserver&&this.editEventObserver.off(),this.deleteEventObserver&&this.deleteEventObserver.off(),this.undeleteEventObserver&&this.undeleteEventObserver.off(),this.syncObserver&&this.syncObserver.off(),this.manualSyncObserver&&this.manualSyncObserver.off(),this.filterChangedObserver&&this.filterChangedObserver.off(),this.onlineObserver&&this.onlineObserver.unsubscribe()},F([Object(E._9)(g.f),Y("design:type",g.f)],n.prototype,"content",void 0),F([Object(E._9)($.a),Y("design:type",$.a)],n.prototype,"splitviewCtrl",void 0),n=F([Object(E.m)({selector:"page-addon-calendar-list",templateUrl:"list.html"}),Y("design:paramtypes",[g.t,N.a,M.a,E.M,P.a,C.a,T.a,w.a,V.a,x.a,S.a,k.a,g.s,R.a,D.a,L.a,A.a,g.w])],n)}(),G=this&&this.__decorate||function(n,e,t,l){var i,a=arguments.length,r=a<3?e:null===l?l=Object.getOwnPropertyDescriptor(e,t):l;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,t,l);else for(var o=n.length-1;o>=0;o--)(i=n[o])&&(r=(a<3?i(r):a>3?i(e,t,r):i(e,t))||r);return a>3&&r&&Object.defineProperty(e,t,r),r},z=function(){function n(){}return n=G([Object(E.I)({declarations:[W],imports:[y.a,I.a,O.a,g.l.forChild(W),b.b.forChild()]})],n)}(),B=t(1528),J=t(1529),K=t(1530),q=t(1531),Q=t(1532),X=t(1533),Z=t(1534),nn=t(1535),en=t(1536),tn=t(1537),ln=t(1538),an=t(1539),rn=t(1540),on=t(47),un=t(8),sn=t(91),cn=t(25),dn=t(17),fn=t(126),_n=t(116),hn=t(30),vn=t(20),pn=t(19),mn=t(26),En=t(102),gn=t(88),bn=t(80),yn=t(251),In=t(7),On=t(33),Cn=t(48),Dn=t(11),xn=t(16),Ln=t(22),wn=t(6),Sn=t(18),Tn=t(15),An=t(21),Vn=t(29),Nn=t(44),Pn=t(43),kn=t(32),Rn=t(36),$n=t(87),jn=t(42),Mn=t(34),Un=t(283),Hn=t(258),Fn=t(218),Yn=t(284),Wn=t(191),Gn=t(229),zn=t(375),Bn=t(39),Jn=t(727),Kn=t(213),qn=t(35),Qn=t(479),Xn=t(728),Zn=t(316),ne=t(250),ee=t(376),te=t(45),le=t(41),ie=t(93),ae=t(79),re=t(71),oe=t(77),ue=t(94),se=t(84),ce=t(480),de=t(73),fe=t(182),_e=t(109),he=t(160),ve=t(214),pe=t(174),me=t(54),Ee=t(51),ge=t(378),be=t(275),ye=t(70),Ie=E._29({encapsulation:2,styles:[],data:{}}),Oe=E._27("page-addon-calendar-list",W,function(n){return E._57(0,[(n()(),E._31(0,0,null,null,1,"page-addon-calendar-list",[],null,null,null,m,Ie)),E._30(1,180224,null,0,W,[ye.a,N.a,M.a,E.M,P.a,C.a,T.a,w.a,V.a,x.a,S.a,k.a,An.a,R.a,D.a,L.a,A.a,re.a],null,null)],null,null)},{},{},[]),Ce=t(23),De=t(371),xe=t(372),Le=t(374),we=t(373),Se=t(478),Te=t(726),Ae=t(273);t.d(e,"AddonCalendarListPageModuleNgFactory",function(){return Ve});var Ve=E._28(z,[],function(n){return E._40([E._41(512,E.o,E._21,[[8,[B.a,J.a,K.a,q.a,Q.a,X.a,Z.a,nn.a,en.a,tn.a,ln.a,an.a,rn.a,Oe]],[3,E.o],E.K]),E._41(4608,In.m,In.l,[E.G,[2,In.w]]),E._41(4608,Ce.x,Ce.x,[]),E._41(4608,Ce.d,Ce.d,[]),E._41(4608,De.b,De.a,[]),E._41(4608,xe.a,xe.b,[]),E._41(4608,Le.b,Le.a,[]),E._41(4608,we.b,we.a,[]),E._41(4608,dn.a,dn.a,[Se.a,De.b,xe.a,Le.b,we.b,dn.b,dn.c]),E._41(512,In.b,In.b,[]),E._41(512,Ce.v,Ce.v,[]),E._41(512,Ce.i,Ce.i,[]),E._41(512,Ce.s,Ce.s,[]),E._41(512,Te.a,Te.a,[]),E._41(512,b.b,b.b,[]),E._41(512,I.a,I.a,[]),E._41(512,O.a,O.a,[]),E._41(512,y.a,y.a,[]),E._41(512,Te.b,Te.b,[]),E._41(512,z,z,[]),E._41(256,dn.c,void 0,[]),E._41(256,dn.b,void 0,[]),E._41(256,Ae.a,W,[])])})}});